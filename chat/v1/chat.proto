syntax = "proto3";

package sgpt.chat.v1;

import "buf/validate/validate.proto";
import "google/api/resource.proto";
import "google/protobuf/descriptor.proto";
import "google/protobuf/timestamp.proto";
import "google/rpc/status.proto";
import "malonaz/ai/v1/message.proto";
import "malonaz/ai/v1/metrics.proto";
import "malonaz/codegen/model/v1/model.proto";

option go_package = "github.com/malonaz/sgpt/genproto/chat/v1";

// A chat represents a chat between a user and SGPT.
message Chat {
  option (google.api.resource) = {
    type: "chat.sgpt.com/Chat"
    pattern: "chats/{chat}"
    singular: "chat"
    plural: "chats"
  };

  option (malonaz.codegen.model.v1.model_opts) = {};

  // The resource name of the chat.
  string name = 1;

  // The creation timestamp of the chat.
  google.protobuf.Timestamp create_time = 2;
  // The last update timestamp of the chat.
  google.protobuf.Timestamp update_time = 3;
  // The deletion timestamp of the chat.
  google.protobuf.Timestamp delete_time = 4 [(malonaz.codegen.model.v1.field_opts).nullable = true];

  // Tags for this chat.
  repeated string tags = 5 [(malonaz.codegen.model.v1.field_opts).nullable = true];

  // Tracks all the files read by this chat.
  repeated string files = 6 [(malonaz.codegen.model.v1.field_opts).nullable = true];

  // Metadata for this chat.
  ChatMetadata metadata = 10 [(malonaz.codegen.model.v1.field_opts).as_proto_bytes = true];
}

// Metadata for a chat.
message ChatMetadata {
  // AI generated title for this chat.
  string title = 1;

  // The resource name of the model currently in use by this chat.
  // Format: providers/{provider}/models/{model}
  string current_model = 2 [
    (google.api.resource_reference).type = "ai.malonaz.com/Model",
    (buf.validate.field).required = true
  ];

  // Total cost of this chat.
  double total_cost = 3;

  // Messages for this chat.
  repeated Message messages = 4;

  // Tracks total model usage.
  repeated malonaz.ai.v1.ModelUsage model_usages = 5;
}

// Message wraps around an ai message.
message Message {
  // The ai message.
  malonaz.ai.v1.Message message = 1;
  // Model usages for this message.
  repeated malonaz.ai.v1.ModelUsage model_usages = 2;
  // Status error if message generation failed.
  google.rpc.Status error = 3;
}
