{{define "base"}}
    <!DOCTYPE html>
    <html>
        <head>
            <title>SGPT - {{.Title}}</title>
            <style>
             {{template "styles"}}
            </style>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
            <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
        </head>
        <body>
            <div class="app">
                {{template "header" .}}
                <main class="main">
                    <div class="content-wrapper">
                        {{if .Chat}}
                            {{template "chat" .}}
                        {{else}}
                            {{template "inbox" .}}
                        {{end}}
                    </div>
                </main>
            </div>

            <script>
             // Copy to clipboard for copyable elements
             document.addEventListener('DOMContentLoaded', function() {
                 document.querySelectorAll('.copyable').forEach(el => {
                     el.addEventListener('click', async function() {
                         try {
                             await navigator.clipboard.writeText(this.textContent);
                             this.classList.add('copied');
                             setTimeout(() => this.classList.remove('copied'), 1500);
                         } catch (err) {
                             console.error('Failed to copy:', err);
                         }
                     });
                 });
             });

             // Add copy buttons to code blocks
             function addCopyButtons() {
                 document.querySelectorAll('pre:not(.has-copy-btn)').forEach(pre => {
                     pre.classList.add('has-copy-btn');
                     const btn = document.createElement('button');
                     btn.className = 'code-copy-btn';
                     btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
                     btn.onclick = async () => {
                         const code = pre.querySelector('code')?.innerText || pre.innerText;
                         try {
                             await navigator.clipboard.writeText(code);
                             btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>';
                             btn.classList.add('copied');
                             setTimeout(() => {
                                 btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
                                 btn.classList.remove('copied');
                             }, 2000);
                         } catch (err) {
                             console.error('Copy failed:', err);
                         }
                     };
                     pre.appendChild(btn);
                 });
             }
             document.addEventListener('DOMContentLoaded', () => setTimeout(addCopyButtons, 100));

             // Delete chat
             async function deleteChat(chatId, event) {
                 event.preventDefault();
                 event.stopPropagation();
                 if (!confirm('Delete this chat?')) return;
                 try {
                     const res = await fetch('/chat/' + chatId, { method: 'DELETE', headers: { 'X-Requested-With': 'XMLHttpRequest' } });
                     if (res.ok) {
                         if (window.location.pathname === '/chat/' + chatId) {
                             window.location.href = '/';
                         } else {
                             const el = event.target.closest('.chat-item');
                             if (el) { el.style.opacity = '0'; setTimeout(() => el.remove(), 200); }
                         }
                     }
                 } catch (e) { console.error(e); }
             }

             // Toggle reasoning blocks
             function toggleReasoning(btn) {
                 const content = btn.nextElementSibling;
                 const isOpen = content.classList.toggle('open');
                 btn.classList.toggle('open', isOpen);
             }
            </script>

            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-shell-session.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-docker.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-regex.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-diff.min.js"></script>
        </body>
    </html>
{{end}}
